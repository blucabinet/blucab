{% extends 'main/base.html' %}

{% block title %}
blucab - Import
{% endblock %}

{% load crispy_forms_tags %}

{% block content %}
<h1>CSV-Import</h1>

{% if user.is_authenticated %}
    <div>This will import a flickrack or blucab exported library .csv for {{ user.get_username }}.</div>
    <br>
    <div class="card" style="max-width: 28rem;">
        <div class="card-body">
            <form method="post" id="importForm" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form|crispy }}
                <input id="fileBtn" type="file" name="myfile">
                <br>
                {% if message %}
                    <p>{{ message }}</p>
                {% else %}
                    <br>
                {% endif %}
                <button id="submitBtn" type="submit" class="btn btn-success">
                    <span id="spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    <span id="btnText">Import</span>
                </button>
            </form>
        </div>
    </div>
    <br>
    <a href="/user/settings" class="btn btn-light" role="button">Back to Settings</a>

    {% if uploaded_file_url %}
        <br><br>
        <p>Processed the file: {{ uploaded_file_url }}</p>
    {% endif %}

    <script>
        const form = document.getElementById("importForm");
        const submitBtn = document.getElementById("submitBtn");
        const btnText = document.getElementById("btnText");
        const spinner = document.getElementById("spinner");

        form.addEventListener("submit", () => {
            submitBtn.disabled = true;
            btnText.textContent = "Importing...";
            spinner.classList.remove("d-none");
        });
    </script>

{% else %}
    <div>Welcome!</div>
    <a class="nav-link" href="/login">Login</a>
{% endif %}

{% endblock %}
